{"componentChunkName":"component---src-templates-blog-detail-tsx","path":"/blog/eager-loading-hasmany-relationship-laravel/","result":{"data":{"blog":{"html":"<p><a href=\"https://laravel.com/docs/8.x/eloquent-relationships#eager-loading\">Eager loading</a> relationships in Laravel makes it\nreally easy to avoid N+1 query problems. This occurs when you run an additional query for each result in a previous\nquery. Take for example a model <code class=\"language-text\">Post</code> that has a <code class=\"language-text\">hasOne</code> relationship with <code class=\"language-text\">User</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token variable\">$posts</span> <span class=\"token operator\">=</span> <span class=\"token class-name static-context\">Post</span><span class=\"token operator\">::</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$posts</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$post</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Retrieve the post author</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token variable\">$post</span><span class=\"token operator\">-></span><span class=\"token property\">user</span><span class=\"token operator\">-></span><span class=\"token property\">name</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This would run an additional query for each post author. To avoid this we use eager loading. This essentially lazy loads\nthe relationship into one extra query.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token variable\">$posts</span> <span class=\"token operator\">=</span> <span class=\"token class-name static-context\">Post</span><span class=\"token operator\">::</span><span class=\"token function\">with</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'user'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now imagine the reverse of that example. You want to query all users and get their latest post. Easy we use eager\nloading to lazy load the <code class=\"language-text\">posts</code> relationship.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token variable\">$users</span> <span class=\"token operator\">=</span> <span class=\"token class-name static-context\">User</span><span class=\"token operator\">::</span><span class=\"token function\">with</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'posts'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>In this case eager loading causes to load all posts for every user. This is bad because we only need the latest post.</p>\n<p>Because the user model has a <code class=\"language-text\">hasMany</code> relationship with posts, all posts are eager loaded for every user. To solve this\nyou might think a simple <code class=\"language-text\">-&gt;limit(1)</code> would do the\ntrick. <a href=\"https://laravel.com/docs/8.x/eloquent-relationships#constraining-eager-loads\">But that does not work</a>.</p>\n<p>The solution is actually pretty simple. In order to load the latest post you can simply create a new <code class=\"language-text\">hasOne</code>\nrelationship on the <code class=\"language-text\">User</code> model.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">latestPost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">hasOne</span><span class=\"token punctuation\">(</span><span class=\"token class-name static-context\">Post</span><span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">latest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>When you use this relationship with eager loading only one post will be queried per user.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token variable\">$users</span> <span class=\"token operator\">=</span> <span class=\"token class-name static-context\">User</span><span class=\"token operator\">::</span><span class=\"token function\">with</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'latestPost'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$users</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$user</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Retrieve the latest post</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token variable\">$user</span><span class=\"token operator\">-></span><span class=\"token property\">latestPost</span><span class=\"token operator\">-></span><span class=\"token property\">title</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>If you're wondering how you can easily keep track of how many queries are run I highly recommend you\ninstall <a href=\"https://github.com/barryvdh/laravel-debugbar\">barryvdh/laravel-debugbar</a>.</p>","excerpt":"Eager loading relationships in Laravel makes it\nreally easy to avoid N+1 query problems. This occurs when you run an additional query for each result in a previous\nquery. Take for example a model…","frontmatter":{"date":"February 1, 2021","published":"2021-02-01T00:00:00.000Z","slug":"/blog/eager-loading-hasmany-relationship-laravel/","title":"Eager loading hasMany relationship in Laravel","tags":["Laravel","Eloquent"],"image":{"childImageSharp":{"fluid":{"src":"/static/1ab69377aafa6aa69b2d20355c2f247e/9842e/eager-loading.jpg"}}}},"fields":{"readingTime":{"text":"2 min read"}}},"blogs":{"nodes":[{"excerpt":"Since version 2.0 Tailwind CSS has a dark mode feature. When Implementing this in a project that uses Storybook for\ncomponent development you want to…","frontmatter":{"title":"Use Tailwind CSS dark mode in Storybook","slug":"/blog/use-tailwind-darkmode-in-storybook/","date":"February 16, 2021","tags":["Tailwindcss","Storybook","Darkmode"],"image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAGABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAEEBv/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAb2YCAf/xAAXEAEBAQEAAAAAAAAAAAAAAAABAgQ0/9oACAEBAAEFAtnLNMtLT//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABgQAAMBAQAAAAAAAAAAAAAAAAABEQJh/9oACAEBAAY/Atly4+F06z//xAAaEAACAgMAAAAAAAAAAAAAAAAAARGxIUFR/9oACAEBAAE/IaNkmfbAlcdtn//aAAwDAQACAAMAAAAQgA//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAbEAACAgMBAAAAAAAAAAAAAAABEQBRITGBof/aAAgBAQABPxBSOk8TH5ExlUJNoDsns//Z","aspectRatio":3.5,"src":"/static/4cca75866ffd4cfebd2262137bfc1d04/a4543/storybook-darkmode.jpg","srcSet":"/static/4cca75866ffd4cfebd2262137bfc1d04/ae4ec/storybook-darkmode.jpg 175w,\n/static/4cca75866ffd4cfebd2262137bfc1d04/2df6c/storybook-darkmode.jpg 350w,\n/static/4cca75866ffd4cfebd2262137bfc1d04/a4543/storybook-darkmode.jpg 700w,\n/static/4cca75866ffd4cfebd2262137bfc1d04/b4210/storybook-darkmode.jpg 731w","srcWebp":"/static/4cca75866ffd4cfebd2262137bfc1d04/5d39c/storybook-darkmode.webp","srcSetWebp":"/static/4cca75866ffd4cfebd2262137bfc1d04/3efd3/storybook-darkmode.webp 175w,\n/static/4cca75866ffd4cfebd2262137bfc1d04/5e193/storybook-darkmode.webp 350w,\n/static/4cca75866ffd4cfebd2262137bfc1d04/5d39c/storybook-darkmode.webp 700w,\n/static/4cca75866ffd4cfebd2262137bfc1d04/52d06/storybook-darkmode.webp 731w","sizes":"(max-width: 700px) 100vw, 700px"}}}}}],"pageInfo":{"hasNextPage":false}},"profile":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAQFA//EABcBAQEBAQAAAAAAAAAAAAAAAAEDAAL/2gAMAwEAAhADEAAAAdmeCQd9hNzVyLT6BP/EABwQAAICAgMAAAAAAAAAAAAAAAECAAMREgQTFP/aAAgBAQABBQKx9Fq5G7G+sHrdakGzecxyS2MQEz//xAAWEQADAAAAAAAAAAAAAAAAAAAAECH/2gAIAQMBAT8BK//EABYRAQEBAAAAAAAAAAAAAAAAABEAEP/aAAgBAgEBPwFnf//EABwQAAEEAwEAAAAAAAAAAAAAAAAQERIhAQIxcf/aAAgBAQAGPwJyOaGkbS9Tpa//xAAbEAADAQEAAwAAAAAAAAAAAAAAAREhMUFhkf/aAAgBAQABPyFb8N8ghqU3jS6I36NjTs09pnqDp18N0sI4RF0//9oADAMBAAIAAwAAABDTEHz/xAAXEQEBAQEAAAAAAAAAAAAAAAABABEh/9oACAEDAQE/EA5ZFtb/xAAXEQEBAQEAAAAAAAAAAAAAAAAAAREh/9oACAECAQE/EDKScZH/xAAbEAEBAAMAAwAAAAAAAAAAAAABEQAhMUFRcf/aAAgBAQABPxDTcoK8vvJg9UUM6ONwDtCGAgphtQ1K/c0PG686JMBDr+MQCDQHhgJkecglM95//9k=","aspectRatio":1,"src":"/static/2f66635801245f1fbc2dd338b3c95d24/77ba7/profile.jpg","srcSet":"/static/2f66635801245f1fbc2dd338b3c95d24/4fb87/profile.jpg 38w,\n/static/2f66635801245f1fbc2dd338b3c95d24/eb304/profile.jpg 75w,\n/static/2f66635801245f1fbc2dd338b3c95d24/77ba7/profile.jpg 150w,\n/static/2f66635801245f1fbc2dd338b3c95d24/1c092/profile.jpg 225w,\n/static/2f66635801245f1fbc2dd338b3c95d24/d6b3b/profile.jpg 300w,\n/static/2f66635801245f1fbc2dd338b3c95d24/f7cac/profile.jpg 500w","srcWebp":"/static/2f66635801245f1fbc2dd338b3c95d24/7e6a7/profile.webp","srcSetWebp":"/static/2f66635801245f1fbc2dd338b3c95d24/ba94f/profile.webp 38w,\n/static/2f66635801245f1fbc2dd338b3c95d24/0e40a/profile.webp 75w,\n/static/2f66635801245f1fbc2dd338b3c95d24/7e6a7/profile.webp 150w,\n/static/2f66635801245f1fbc2dd338b3c95d24/acb75/profile.webp 225w,\n/static/2f66635801245f1fbc2dd338b3c95d24/df676/profile.webp 300w,\n/static/2f66635801245f1fbc2dd338b3c95d24/d4fb8/profile.webp 500w","sizes":"(max-width: 150px) 100vw, 150px"}}}},"pageContext":{"slug":"/blog/eager-loading-hasmany-relationship-laravel/"}},"staticQueryHashes":["167392381"]}